<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Brief Introduction to RNeXML â€¢ RNeXML</title>
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A Brief Introduction to RNeXML">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RNeXML</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/S4.html">The nexml S4 Object</a>
    </li>
    <li>
      <a href="../articles/intro.html">A Brief Introduction to RNeXML</a>
    </li>
    <li>
      <a href="../articles/manuscripts/manuscript.pdf">RNeXML: a package for reading and writing richly annotated phylogenetic, character, and trait data in R (PDF)</a>
    </li>
    <li>
      <a href="../articles/metadata.html">Handling Metadata in RNeXML</a>
    </li>
    <li>
      <a href="../articles/simmap.html">Extending NeXML: an example based on simmap</a>
    </li>
    <li>
      <a href="../articles/sparql.html">SPARQL with RNeXML</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ropensci/RNeXML">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>A Brief Introduction to RNeXML</h1>
                        <h4 class="author">Carl Boettiger</h4>
                        <h4 class="author">Scott Chamberlain</h4>
                        <h4 class="author">Rutger Vos</h4>
                        <h4 class="author">Hilmar Lapp</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/RNeXML/blob/master/vignettes/intro.Rmd"><code>vignettes/intro.Rmd</code></a></small>
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr::rmarkdown}
%\VignetteIndexEntry{A Brief Introduction to RNeXMLL}
-->
<pre><code>## Loading required package: ape</code></pre>
<p>Read in a <code>nexml</code> file into the <code><a href="http://www.rdocumentation.org/packages/ape/topics/read.tree">ape::phylo</a></code> format:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"examples"</span>, <span class="st">"comp_analysis.xml"</span>, <span class="dt">package=</span><span class="st">"RNeXML"</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">nexml &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nexml_read.html">nexml_read</a></span>(f)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">tr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_trees.html">get_trees</a></span>(nexml) <span class="co"># or: as(nexml, "phylo")</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw">plot</span>(tr)</a></code></pre></div>
<p><img src="intro_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<p>Write an <code><a href="http://www.rdocumentation.org/packages/ape/topics/read.tree">ape::phylo</a></code> tree into the <code>nexml</code> format:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">data</span>(bird.orders)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="../reference/nexml_write.html">nexml_write</a></span>(bird.orders, <span class="st">"test.xml"</span>)</a></code></pre></div>
<pre><code>## [1] "test.xml"</code></pre>
<p>A key feature of NeXML is the ability to formally validate the construction of the data file against the standard (the lack of such a feature in nexus files had lead to inconsistencies across different software platforms, and some files that cannot be read at all). While it is difficult to make an invalid NeXML file from <code>RNeXML</code>, it never hurts to validate just to be sure:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw"><a href="../reference/nexml_validate.html">nexml_validate</a></span>(<span class="st">"test.xml"</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Extract metadata from the NeXML file:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">birds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nexml_read.html">nexml_read</a></span>(<span class="st">"test.xml"</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="../reference/get_taxa.html">get_taxa</a></span>(birds)</a></code></pre></div>
<pre><code>##     otu            label xsi.type otus
## 1   ou1 Struthioniformes       NA  os1
## 2   ou2     Tinamiformes       NA  os1
## 3   ou3      Craciformes       NA  os1
## 4   ou4      Galliformes       NA  os1
## 5   ou5     Anseriformes       NA  os1
## 6   ou6    Turniciformes       NA  os1
## 7   ou7       Piciformes       NA  os1
## 8   ou8    Galbuliformes       NA  os1
## 9   ou9   Bucerotiformes       NA  os1
## 10 ou10      Upupiformes       NA  os1
## 11 ou11    Trogoniformes       NA  os1
## 12 ou12    Coraciiformes       NA  os1
## 13 ou13      Coliiformes       NA  os1
## 14 ou14     Cuculiformes       NA  os1
## 15 ou15   Psittaciformes       NA  os1
## 16 ou16      Apodiformes       NA  os1
## 17 ou17   Trochiliformes       NA  os1
## 18 ou18  Musophagiformes       NA  os1
## 19 ou19     Strigiformes       NA  os1
## 20 ou20    Columbiformes       NA  os1
## 21 ou21       Gruiformes       NA  os1
## 22 ou22    Ciconiiformes       NA  os1
## 23 ou23    Passeriformes       NA  os1</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="../reference/get_metadata.html">get_metadata</a></span>(birds) </a></code></pre></div>
<pre><code>##           property   datatype                 content     xsi.type
## 1       dc:creator xsd:string                cboettig  LiteralMeta
## 2 dcterms:modified xsd:string 2018-11-30 18:08:48 GMT  LiteralMeta
## 3       cc:license       &lt;NA&gt;                    &lt;NA&gt; ResourceMeta
##                                                href Meta
## 1                                              &lt;NA&gt;   m1
## 2                                              &lt;NA&gt;   m2
## 3 http://creativecommons.org/publicdomain/zero/1.0/   m3</code></pre>
<hr>
<p>Add basic additional metadata:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">  <span class="kw"><a href="../reference/nexml_write.html">nexml_write</a></span>(bird.orders, <span class="dt">file=</span><span class="st">"meta_example.xml"</span>,</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">              <span class="dt">title =</span> <span class="st">"My test title"</span>,</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">              <span class="dt">description =</span> <span class="st">"A description of my test"</span>,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">              <span class="dt">creator =</span> <span class="st">"Carl Boettiger &lt;cboettig@gmail.com&gt;"</span>,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">              <span class="dt">publisher =</span> <span class="st">"unpublished data"</span>,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">              <span class="dt">pubdate =</span> <span class="st">"2012-04-01"</span>)</a></code></pre></div>
<pre><code>## [1] "meta_example.xml"</code></pre>
<p>By default, <code>RNeXML</code> adds certain metadata, including the NCBI taxon id numbers for all named taxa. This acts a check on the spelling and definitions of the taxa as well as providing a link to additional metadata about each taxonomic unit described in the dataset.</p>
<div id="advanced-annotation" class="section level3">
<h3 class="hasAnchor">
<a href="#advanced-annotation" class="anchor"></a>Advanced annotation</h3>
<p>We can also add arbitrary metadata to a NeXML tree by define <code>meta</code> objects:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">modified &lt;-<span class="st"> </span><span class="kw"><a href="../reference/meta.html">meta</a></span>(<span class="dt">property =</span> <span class="st">"prism:modificationDate"</span>,</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">                 <span class="dt">content =</span> <span class="st">"2013-10-04"</span>)</a></code></pre></div>
<p>Advanced use requires specifying the namespace used. Metadata follows the RDFa conventions. Here we indicate the modification date using the prism vocabulary. This namespace is included by default, as it is used for some of the basic metadata shown in the previous example. We can see from this list:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">RNeXML<span class="op">:::</span>nexml_namespaces</a></code></pre></div>
<pre><code>##                                              nex 
##                      "http://www.nexml.org/2009" 
##                                              xsi 
##      "http://www.w3.org/2001/XMLSchema-instance" 
##                                              xml 
##           "http://www.w3.org/XML/1998/namespace" 
##                                             cdao 
##                "http://purl.obolibrary.org/obo/" 
##                                              xsd 
##              "http://www.w3.org/2001/XMLSchema#" 
##                                               dc 
##               "http://purl.org/dc/elements/1.1/" 
##                                          dcterms 
##                      "http://purl.org/dc/terms/" 
##                                              ter 
##                      "http://purl.org/dc/terms/" 
##                                            prism 
## "http://prismstandard.org/namespaces/1.2/basic/" 
##                                               cc 
##                 "http://creativecommons.org/ns#" 
##                                             ncbi 
##          "http://www.ncbi.nlm.nih.gov/taxonomy#" 
##                                               tc 
##  "http://rs.tdwg.org/ontology/voc/TaxonConcept#"</code></pre>
<p>This next block defines a resource (link), described by the <code>rel</code> attribute as a homepage, a term in the <code>foaf</code> vocabulalry. Becuase <code>foaf</code> is not a default namespace, we will have to provide its URL in the full definition below.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">website &lt;-<span class="st"> </span><span class="kw"><a href="../reference/meta.html">meta</a></span>(<span class="dt">href =</span> <span class="st">"http://carlboettiger.info"</span>, </a>
<a class="sourceLine" id="cb16-2" data-line-number="2">                <span class="dt">rel =</span> <span class="st">"foaf:homepage"</span>)</a></code></pre></div>
<p>Here we create a history node using the <code>skos</code> namespace. We can also add id values to any metadata element to make the element easier to reference externally:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">  history &lt;-<span class="st"> </span><span class="kw"><a href="../reference/meta.html">meta</a></span>(<span class="dt">property =</span> <span class="st">"skos:historyNote"</span>, </a>
<a class="sourceLine" id="cb17-2" data-line-number="2">                  <span class="dt">content =</span> <span class="st">"Mapped from the bird.orders data in the ape package using RNeXML"</span>,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">                  <span class="dt">id =</span> <span class="st">"meta123"</span>)</a></code></pre></div>
<p>For this kind of richer annotation, it is best to build up our NeXML object sequentially. Frist we will add <code>bird.orders</code> phylogeny to a new phylogenetic object, and then we will add the metadata elements created above to this object. Finally, we will write the object out as an XML file:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1">  birds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_trees.html">add_trees</a></span>(bird.orders)</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">  birds &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_meta.html">add_meta</a></span>(<span class="dt">meta =</span> <span class="kw">list</span>(history, modified, website),</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">                    <span class="dt">namespaces =</span> <span class="kw">c</span>(<span class="dt">skos =</span> <span class="st">"http://www.w3.org/2004/02/skos/core#"</span>,</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">                                   <span class="dt">foaf =</span> <span class="st">"http://xmlns.com/foaf/0.1/"</span>),</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">                    <span class="dt">nexml=</span>birds)</a>
<a class="sourceLine" id="cb18-6" data-line-number="6">  <span class="kw"><a href="../reference/nexml_write.html">nexml_write</a></span>(birds, </a>
<a class="sourceLine" id="cb18-7" data-line-number="7">              <span class="dt">file =</span> <span class="st">"example.xml"</span>)</a></code></pre></div>
<pre><code>## [1] "example.xml"</code></pre>
</div>
<div id="taxonomic-identifiers" class="section level3">
<h3 class="hasAnchor">
<a href="#taxonomic-identifiers" class="anchor"></a>Taxonomic identifiers</h3>
<p>Add taxonomic identifier metadata to the OTU elements: <!-- This block relies on a robust internet connection that can occassionally fail.  Also it's a bit slow, so don't run it. After all, this command is tested in the unit tests.--></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">nex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_trees.html">add_trees</a></span>(bird.orders)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">nex &lt;-<span class="st"> </span><span class="kw"><a href="../reference/taxize_nexml.html">taxize_nexml</a></span>(nex)</a></code></pre></div>
</div>
<div id="working-with-character-data" class="section level2">
<h2 class="hasAnchor">
<a href="#working-with-character-data" class="anchor"></a>Working with character data</h2>
<p>NeXML also provides a standard exchange format for handling character data. The R platform is particularly popular in the context of phylogenetic comparative methods, which consider both a given phylogeny and a set of traits. NeXML provides an ideal tool for handling this metadata.</p>
<div id="extracting-character-data" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-character-data" class="anchor"></a>Extracting character data</h3>
<p>We can load the library, parse the NeXML file and extract both the characters and the phylogeny.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">library</span>(RNeXML)</a>
<a class="sourceLine" id="cb21-2" data-line-number="2">nexml &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nexml_read.html">read.nexml</a></span>(<span class="kw">system.file</span>(<span class="st">"examples"</span>, <span class="st">"comp_analysis.xml"</span>, <span class="dt">package=</span><span class="st">"RNeXML"</span>))</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">traits &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_characters.html">get_characters</a></span>(nexml)</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">tree &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_trees.html">get_trees</a></span>(nexml)</a></code></pre></div>
<p>(Note that <code>get_characters</code> would return both discrete and continuous characters together in the same data.frame, but we use <code>get_characters_list</code> to get separate data.frames for the continuous <code>characters</code> block and the discrete <code>characters</code> block).</p>
<p>We can then fire up <code>geiger</code> and fit, say, a Brownian motion model the continuous data and a Markov transition matrix to the discrete states:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">library</span>(geiger)</a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw"><a href="http://www.rdocumentation.org/packages/geiger/topics/fitContinuous">fitContinuous</a></span>(tree, traits[<span class="dv">1</span>], <span class="dt">ncores=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## GEIGER-fitted comparative model of continuous data
##  fitted 'BM' model parameters:
##  sigsq = 1.166011
##  z0 = 0.255591
## 
##  model summary:
##  log-likelihood = -20.501183
##  AIC = 45.002367
##  AICc = 46.716652
##  free parameters = 2
## 
## Convergence diagnostics:
##  optimization iterations = 100
##  failed iterations = 0
##  frequency of best fit = 1.00
## 
##  object summary:
##  'lik' -- likelihood function
##  'bnd' -- bounds for likelihood search
##  'res' -- optimization iteration summary
##  'opt' -- maximum likelihood parameter estimates</code></pre>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="http://www.rdocumentation.org/packages/geiger/topics/fitDiscrete">fitDiscrete</a></span>(tree, traits[<span class="dv">2</span>], <span class="dt">ncores=</span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## GEIGER-fitted comparative model of discrete data
##  fitted Q matrix:
##                 0           1
##     0 -0.07308302  0.07308302
##     1  0.07308302 -0.07308302
## 
##  model summary:
##  log-likelihood = -4.574133
##  AIC = 11.148266
##  AICc = 11.648266
##  free parameters = 1
## 
## Convergence diagnostics:
##  optimization iterations = 100
##  failed iterations = 0
##  frequency of best fit = 1.00
## 
##  object summary:
##  'lik' -- likelihood function
##  'bnd' -- bounds for likelihood search
##  'res' -- optimization iteration summary
##  'opt' -- maximum likelihood parameter estimates</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#working-with-character-data">Working with character data</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Carl Boettiger, Scott Chamberlain, Hilmar Lapp, Kseniia Shumelchyk, Rutger Vos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
